/*
 * Analogue.c
 *
 *  Created on: Apr 29, 2024
 *      Author: eleve
 */

#include <stm32g4xx_hal.h>
#include "Analogue.h"
//extern ADC_HandleTypeDef hadc1

int adc_available = 0; // Indique si l'ADC à fini la conversion Analog->Digital
uint16_t adc_tab[4];

void Analogue_init(void)
{
	HAL_ADC_Start_DMA(&hadc1, (uint32_t*)adc_tab, 4); // Active l'ADC
	HAL_TIM_Base_Start(&htim6); // Appel la fonction Analogue_irq_callback() quand la conversion Analog->Digital est finie
}

void Analogue_irq_callback(void)
{
	adc_available == 1; // Indique que la conversion Analog->Digital est finie
}

void Analogue_process(void)
{
	if (adc_available == 1) // Si l'ADC a convertit la tension en numérique
	{
		adc_available = 0;
		for(int itr = 0 ; itr < 4 ; itr++) // Affiche les valeurs numérique des 4 potentiomètres
		{
			printf("%u\t", adc_tab[itr]);
		}
		printf("\r\n");
	}
}
